# Demo2025
Решение Demo2025 по специальности 09.02.06 Сетевое и системное администрирование

![image](https://github.com/user-attachments/assets/5e93864e-93db-42b9-ac98-494d5679c599)


<details>
  <summary>Модуль № 1: Настройка сетевой инфраструктуры (нажмите для развертывания)</summary>

> **Текст задания:**  
> 
> Вид аттестации/уровень ДЭ: ПА, ГИА ДЭ БУ, ГИА ДЭ ПУ (инвариантная часть)
> 
> **Задание:**  
> Необходимо разработать и настроить инфраструктуру информационно-коммуникационной системы согласно предложенной топологии (см. Рисунок 1). Задание включает базовую настройку устройств:
> - Присвоение имен устройствам,
> - Расчёт IP-адресации,
> - Настройку коммутации и маршрутизации.
> 
> В ходе проектирования и настройки сетевой инфраструктуры следует вести отчёт о своих действиях, включая таблицы и схемы, предусмотренные в задании. Итоговый отчёт должен содержать одну таблицу и пять отчётов о ходе работы. Итоговый отчёт по окончании работы следует сохранить на диске рабочего места.
> 
> **Рисунок 1. Топология сети**
> 
> **Таблица 1**
> 
> | Машина    | RAM (ГБ) | CPU | HDD/SDD (ГБ) | OS                                   |
> |-----------|----------|-----|--------------|---------------------------------------|
> | ISP       | 1        | 1   | 10           | ОС Альт JeOS/Linux или аналог         |
> | HQ-RTR    | 1        | 1   | 10           | ОС EcoRouter или аналог               |
> | BR-RTR    | 1        | 1   | 10           | ОС EcoRouter или аналог               |
> | HQ-SRV    | 2        | 1   | 10           | ОС Альт Сервер/аналог                  |
> | BR-SRV    | 2        | 1   | 10           | ОС Альт Сервер/аналог                  |
> | HQ-CLI    | 3        | 2   | 15           | ОС Альт Рабочая Станция/аналог         |
> | **Итого** | **10**   | **7** | **65**     | —                                     |
> 
> 1. Произведите базовую настройку устройств:
>    - Настройте имена устройств согласно топологии. Используйте полное доменное имя.
>    - На всех устройствах необходимо сконфигурировать IPv4.
>    - IP-адрес должен быть из приватного диапазона (RFC1918), если сеть локальная.
>    - Локальная сеть в сторону HQ-SRV (VLAN100) должна вмещать не более 64 адресов.
>    - Локальная сеть в сторону HQ-CLI (VLAN200) — не более 16 адресов.
>    - Локальная сеть в сторону BR-SRV — не более 32 адресов.
>    - Локальная сеть для управления (VLAN999) — не более 8 адресов.
>    - Сведения об адресах занесите в отчёт, в качестве примера используйте Таблицу 3.
> 
> 2. Настройка ISP:
>    - Настройте адресацию на интерфейсах:
>      - Интерфейс, подключённый к магистральному провайдеру, получает адрес по DHCP.
>      - Настройте маршруты по умолчанию там, где это необходимо.
>      - Интерфейс, к которому подключен HQ-RTR, – сеть 172.16.4.0/28.
>      - Интерфейс, к которому подключен BR-RTR, – сеть 172.16.5.0/28.
>      - На ISP настройте динамическую NAT-трансляцию в сторону HQ-RTR и BR-RTR для доступа к Интернету.
> 
> 3. Создание локальных учетных записей:
>    - Создайте пользователя **sshuser** на серверах HQ-SRV и BR-SRV:
>      - Пароль: `P@ssw0rd`
>      - Идентификатор пользователя: 1010
>      - Пользователь должен иметь возможность запускать `sudo` без дополнительной аутентификации.
>    - Создайте пользователя **net_admin** на маршрутизаторах HQ-RTR и BR-RTR:
>      - Пароль: `P@$$word`
>      - Пользователь должен обладать максимальными привилегиями и иметь возможность запускать `sudo` без доп. аутентификации.
> 
> 4. Настройте на интерфейсе HQ-RTR в сторону офиса HQ виртуальный коммутатор:
>    - Сервер HQ-SRV – в ID VLAN 100.
>    - Клиент HQ-CLI – в ID VLAN 200.
>    - Создайте подсеть управления с ID VLAN 999.
>    - Сведения о настройке коммутатора и выборе реализации разделения на VLAN занесите в отчёт.
> 
> 5. Настройка безопасного удалённого доступа на серверах HQ-SRV и BR-SRV:
>    - Для подключения используйте порт 2024.
>    - Разрешите подключения только пользователю **sshuser**.
>    - Ограничьте количество попыток входа до двух.
>    - Настройте баннер «Authorized access only».
> 
> 6. Между офисами HQ и BR необходимо сконфигурировать IP-туннель:
>    - Сведения о туннеле занесите в отчёт.
>    - Выберите технологию GRE или IP-in-IP.
> 
> 7. Обеспечьте динамическую маршрутизацию:
>    - Ресурсы одного офиса должны быть доступны из другого.
>    - Для динамической маршрутизации используйте link state протокол (на ваше усмотрение), разрешив его только на интерфейсах IP-туннеля.
>    - Маршрутизаторы должны делиться маршрутами только друг с другом.
>    - Обеспечьте защиту протокола посредством парольной защиты.
>    - Сведения о настройке и защите протокола занесите в отчёт.
> 
> 8. Настройка динамической трансляции адресов:
>    - Настройте динамическую NAT-трансляцию для обоих офисов.
>    - Все устройства в офисах должны иметь доступ к Интернету.
> 
> 9. Настройка протокола динамической конфигурации хостов (DHCP):
>    - Настройте нужную подсеть.
>    - Для офиса HQ маршрутизатор HQ-RTR выступает в роли DHCP-сервера.
>    - Клиент – машина HQ-CLI.
>    - Исключите из выдачи адрес маршрутизатора.
>    - Шлюз по умолчанию – IP адрес HQ-RTR.
>    - DNS-сервер для HQ-CLI – IP адрес HQ-SRV.
>    - DNS-суффикс для офисов HQ – `au-team.irpo`.
>    - Сведения о настройке протокола занесите в отчёт.
> 
> 10. Настройка DNS для офисов HQ и BR:
>     - Основной DNS-сервер реализован на HQ-SRV.
>     - Сервер должен обеспечивать разрешение имён устройств в IP-адреса и обратно (согласно Таблице 2).
>     - В качестве DNS-сервера пересылки используйте любой общедоступный DNS-сервер.
> 
> 11. Настройте часовой пояс на всех устройствах согласно месту проведения экзамена.

</details>

### Таблица 1. Топологическая информация

| Машина    | RAM (ГБ) | CPU | HDD/SDD (ГБ) | OS                                   |
|-----------|----------|-----|--------------|---------------------------------------|
| ISP       | 1        | 1   | 10           | ОС Альт JeOS/Linux или аналог         |
| HQ-RTR    | 1        | 1   | 10           | ОС EcoRouter или аналог               |
| BR-RTR    | 1        | 1   | 10           | ОС EcoRouter или аналог               |
| HQ-SRV    | 2        | 1   | 10           | ОС Альт Сервер/аналог                  |
| BR-SRV    | 2        | 1   | 10           | ОС Альт Сервер/аналог                  |
| HQ-CLI    | 3        | 2   | 15           | ОС Альт Рабочая Станция/аналог         |
| **Итого** | **10**   | **7** | **65**     | —                                     |

###  Диапазоны IP-адресов по RFC1918

| Диапазон             | CIDR           | Количество адресов | Пример диапазона               |
|----------------------|----------------|--------------------|--------------------------------|
| Класс A              | 10.0.0.0/8     | 16,777,216         | 10.0.0.0 – 10.255.255.255        |
| Класс B              | 172.16.0.0/12  | 1,048,576          | 172.16.0.0 – 172.31.255.255       |
| Класс C              | 192.168.0.0/16 | 65,536             | 192.168.0.0 – 192.168.255.255     |

### Разделение IP-адресов по VLAN

| VLAN ID | Назначение                 | Сеть         | Маска | Количество адресов | Диапазон IP адресов            |
|---------|----------------------------|--------------|-------|--------------------|--------------------------------|
| 100     | Офис HQ-SRV                | 192.168.10.0 | /26   | 64                 | 192.168.10.0 – 192.168.10.63    |
| 200     | Офис HQ-CLI                | 192.168.20.0 | /28   | 16                 | 192.168.20.0 – 192.168.20.15    |
| 300     | Офис BR-SRV                | 192.168.30.0 | /27   | 32                 | 192.168.30.0 – 192.168.30.31    |
| 999     | Управление (служебная сеть) | 192.168.99.0 | /29   | 8                  | 192.168.99.0 – 192.168.99.7     |

### Адресация и шлюзы для настройки ISP

| Подключение         | Сеть           | IP-адрес (устройство)    | IP-адрес (ISP)   | Шлюз по умолчанию (для устройства внутри сети) |
|---------------------|----------------|--------------------------|------------------|------------------------------------|
| HQ-RTR – ISP        | 172.16.4.0/28  | 172.16.4.2 (HQ-RTR)      | 172.16.4.1       | 172.16.4.2                         |
| BR-RTR – ISP        | 172.16.5.0/28  | 172.16.5.2 (BR-RTR)      | 172.16.5.1       | 172.16.5.2                         |


# Решение

---

## 1. Настройка имён устройств

Для соответствия топологии используйте полные доменные имена:

```bash
hostnamectl set-hostname isp.au.team.irpo; exec bash
hostnamectl set-hostname hq-rtr.au.team.irpo; exec bash
hostnamectl set-hostname br-rtr.au.team.irpo; exec bash
hostnamectl set-hostname hq-srv.au.team.irpo; exec bash
hostnamectl set-hostname hq-cli.au.team.irpo; exec bash
hostnamectl set-hostname br-srv.au.team.irpo; exec bash
```

---

## 2. Конфигурация IPv4 на JeOS

### 2.0 настройка hostname

если вы не задали hostname в самом начала прописываем:

```bash
hostnamectl set-hostname isp.au.team.irpo; exec bash
```

### 2.1 проверка настроек по dhcp

проверяем получили ли мы настройки по dhcp командой
```bash
ip addr
```
Если не получили найстройки  DHCP выполняем настройку.

### 2.2 Редактирование конфигурационного файла через Vim

Откройте файл с настройками для вашего сетевого адаптера:

```bash
vi /etc/net/ifaces/<название_сетевого_адаптера>/options
```

войдите в режим удаление (нажмите `x`) удалите строку `BOOTPROTO=static` потом (нажмите `i`) и напишите `BOOTPROTO=dhcp`.
После чего нажмите 2 раза сочетание клавиш `ctrl + c` потом cохраните изменения командой `:wq`

#### Полезные команды Vim:

- **Навигация:**
  - `h` – перемещение курсора влево  
  - `j` – перемещение курсора вниз  
  - `k` – перемещение курсора вверх  
  - `l` – перемещение курсора вправо  
  - `w` – переход к началу следующего слова  
  - `b` – переход к началу предыдущего слова  
  - `e` – переход к концу слова  
  - `0` – начало строки  
  - `$` – конец строки  
  - `gg` – начало файла  
  - `G` – конец файла  

- **Редактирование:**
  - `i` – вставка текста перед курсором  
  - `a` – вставка текста после курсора  
  - `o` – создание новой строки после текущей и переход в режим вставки  
  - `dd` – вырезать строку  
  - `yy` – копировать строку  
  - `p` – вставить скопированный/вырезанный текст  
  - `u` – отмена последнего действия  
  - `Ctrl + r` – повтор отменённого действия  

- **Сохранение и выход:**
  - `:w` – сохранить файл  
  - `:q` – выйти из редактора  
  - `:wq` – сохранить и выйти

---

## 3. Перезагрузка сети и обновление пакетов

Перезагрузите сетевые сервисы:

```bash
systemctl restart network
```

Обновите список пакетов и установите необходимые утилиты:

```bash
apt-get update -y && apt-get install nano -y && apt-get install iptables -y
```

Очистите консоль:

```bash
clear
```

---

## 4. Настройка сетевых адаптеров

1. Определите названия ваших сетевых адаптеров:

    ```bash
    ip addr
    ```

2. Проверьте наличие каталогов для интерфейсов:

    ```bash
    ls /etc/net/ifaces/
    ```

   Если каталогов меньше трёх (один из создаётся по умолчанию), создайте необходимые:

    ```bash
    mkdir /etc/net/ifaces/<название_интерфейса> /etc/net/ifaces/<название_интерфейса>
    ```

3. Отредактируйте файл настроек для каждого интерфейса:

    ```bash
    nano /etc/net/ifaces/<название_интерфейса>/options
    ```

  содержимого файла:

    ```
    BOOTPROTO=static
    TYPE=eth
    ```

4. Сохраните файл (Ctrl+O, затем Ctrl+X) и скопируйте его для других интерфейсов, если это необходимо:

    ```bash
    cp /etc/net/ifaces/<название_интерфейса>/options /etc/net/ifaces/<название_другого_интерфейса>/options
    ```

5. Создайте файл для задания IP-адреса для подсети HQ:

    ```bash
    nano /etc/net/ifaces/<название_интерфейса>/ipv4address
    ```

   Пример содержимого:

    ```
    172.16.4.1/28
    ```
6. Создайте файл для задания IP-адреса для подсети BR:

    ```bash
    nano /etc/net/ifaces/<название_интерфейса>/ipv4address
    ```

   Пример содержимого:

    ```
    172.16.5.1/28
    ```
7. Перезагрузите сеть:

    ```bash
    systemctl restart network
    ```
8. Проверяем появились ли ip у интерфейсов:

    ```bash
    ip addr
    ```
---

## 5. Настройка динамической маршрутизации (NAT)

Настройте маскарадинг для подсетей HQ-RTR и BR-RTR.

### 5.1 Для HQ-RTR

```bash
iptables -t nat -A POSTROUTING -o <порт_внешней_сети> -s <IP_подсети>/<префикс> -j MASQUERADE
```

_Пример:_

```bash
iptables -t nat -A POSTROUTING -o ens33 -s 172.16.4.0/28 -j MASQUERADE
```

*Пояснение:*

- `iptables` — утилита для настройки правил брандмауэра.  
- `-t nat` — выбор таблицы NAT для трансляции адресов.  
- `-A POSTROUTING` — правило применяется после маршрутизации.  
- `-o ens33` — правило для интерфейса, выходящего в интернет.  
- `-s 172.16.4.0/28` — правило для трафика из указанной подсети.  
- `-j MASQUERADE` — маскарадинг (замена исходного IP на IP интерфейса).

### 5.2 Для BR-RTR

```bash
iptables -t nat -A POSTROUTING -o ens33 -s 172.16.5.0/28 -j MASQUERADE
```

### 5.3 Сохранение и автозапуск

Сохраните текущие правила:

```bash
iptables-save > /etc/sysconfig/iptables
```

Добавьте iptables в автозагрузку:

```bash
systemctl enable --now iptables
```

---

## 6. Включение пересылки пакетов

Для включения пересылки пакетов между интерфейсами отредактируйте файл `/etc/net/sysctl.conf`:

```bash
nano /etc/net/sysctl.conf
```

Найдите строку:

```
net.ipv4.ip_forward = 0
```

и замените её на:

```
net.ipv4.ip_forward = 1
```

Сохраните изменения (Ctrl+O, затем Ctrl+X).

7. Перезагрузите сеть:

    ```bash
    systemctl restart network
    ```

---

## 7.  настройка сети для HQ-RTR

### 7.0 настройка hostname

если вы не задали hostname в самом начала прописываем:

```bash
hostnamectl set-hostname hq-rtr.au.team.irpo; exec bash
```

### 7.1 настройка параметров сетевого интерфейса

Откройте файл настроек:

```bash
vi /etc/net/ifaces/<название_интерфейса>/options
```

Удалите следущие строки

- `NM_CONTROLLED`
- `DISABLED`
- `SYSTEMD_CONTROLLED`

### 7.2 Настройка IP-адреса

Создайте и отредактируйте файл `ipv4address`:

```bash
vi /etc/net/ifaces/<название_интерфейса>/ipv4address
```

Пропишите IP-адрес с маской, соответствующий подсети роутера (например, `172.16.4.2/28`).

### 7.3 Настройка маршрутизации

Отредактируйте файл `ipv4route`:

```bash
vi /etc/net/ifaces/<название_интерфейса>/ipv4route
```

Добавьте строку с маршрутом по умолчанию:

```
default via <IP_роутера>
```

_Пример:_

```
default via 172.16.4.1
```

### 7.4 Настройка DNS

Отредактируйте файл `resolv.conf`:

```bash
vi /etc/net/ifaces/<название_интерфейса>/resolv.conf
```

Добавьте строку с DNS-сервером:

```
nameserver 172.16.4.1
```

### 7.5 Финальные шаги

-  удалите `systemd-networkd` для устранения конфликтов с dns сервером.
- Перезагрузите сеть:

  ```bash
  systemctl restart network
  ```

- Проверьте доступность DNS-имен:

  ```bash
  ping ya.ru
  ```

- Обновите пакеты и установите `nano`:

  ```bash
  apt-get update -y && apt-get install nano -y
  ```

---
## 8.  настройка сети для BR-RTR

### 8.0 настройка hostname

если вы не задали hostname в самом начала прописываем:

```bash
hostnamectl set-hostname br-rtr.au.team.irpo; exec bash
```

### 8.1 настройка параметров сетевого интерфейса

Откройте файл настроек:

```bash
vi /etc/net/ifaces/<название_интерфейса>/options
```

Удалите следущие строки

- `NM_CONTROLLED`
- `DISABLED`
- `SYSTEMD_CONTROLLED`

### 8.2 Настройка IP-адреса

Создайте и отредактируйте файл `ipv4address`:

```bash
vi /etc/net/ifaces/<название_интерфейса>/ipv4address
```

Пропишите IP-адрес с маской, соответствующий подсети роутера (например, `172.16.5.2/28`).

### 8.3 Настройка маршрутизации

Отредактируйте файл `ipv4route`:

```bash
vi /etc/net/ifaces/<название_интерфейса>/ipv4route
```

Добавьте строку с маршрутом по умолчанию:

```
default via <IP_роутера>
```

_Пример:_

```
default via 172.16.5.1
```

### 8.4 Настройка DNS

Отредактируйте файл `resolv.conf`:

```bash
vi /etc/net/ifaces/<название_интерфейса>/resolv.conf
```

Добавьте строку с DNS-сервером:

```
nameserver 172.16.5.1
```

### 8.5 Финальные шаги

-  удалите `systemd-networkd` для устранения конфликтов с dns сервером командной:.
 
  ```bash
  apt-get remove systemd-networkd
  ```
- Перезагрузите сеть:

  ```bash
  systemctl restart network
  ```

- Проверьте доступность DNS-имен:

  ```bash
  ping ya.ru
  ```

- Обновите пакеты и установите `nano`:

  ```bash
  apt-get update -y && apt-get install nano -y
  ```

---
## 9. Настройка динамической маршрутизации (NAT)

Настройте маскарадинг для подсетей HQ-RTR и BR-RTR.

### 5.1 Для HQ-RTR

```bash
iptables -t nat -A POSTROUTING -o <порт_внешней_сети> -s <IP_подсети>/<префикс> -j MASQUERADE
```
